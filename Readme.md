# 音源分離＆ファイル管理システム ドキュメント

## 1. システム概要

このシステムは、音源分離機能とファイル管理機能を組み合わせた総合的なオーディオ処理ツールです。主に以下の機能を提供します：

1. 音源分離：音楽ファイルからボーカル、ドラム、ベース、その他の楽器を分離
2. ファイル管理：処理済みのファイルを自動的に整理・リネーム

## 2. 主要機能

### 2.1 音源分離

- 対応フォーマット：WAV、MP3
- 分離可能な音源：
  - ボーカル
  - ドラム
  - ベース
  - その他の楽器
- 使用モデル：OpenUnmix（umxhq）

### 2.2 ファイル管理

- 自動ファイルリネーム
- 指定されたディレクトリ構造への自動整理
- 処理前後のファイルの移動と整理

## 3. 技術仕様

### 3.1 フロントエンド

- 開発言語：HTML, CSS, JavaScript
- フレームワーク：Electron

### 3.2 バックエンド

- 開発言語：Python
- 主要ライブラリ：
  - Flask
  - librosa
  - numpy
  - openunmix
  - torch
  - torchaudio

### 3.3 ビルドツール

- electron-builder

## 4. システム構成

```
tokoroten-localapp/
├── .gitignore
├── Readme.md
├── api.spec
├── electron-builder.yml
├── icon.icns
├── package.json
├── python/
│   ├── api.py
│   ├── audio_processing.py
│   ├── requirements.txt
├── src/
│   ├── index.html
│   ├── main.js
│   ├── preload.js
│   ├── renderer.js
│   ├── styles.css
```

## 5. インストールと設定

1. リポジトリをクローン
2. 必要な依存関係をインストール：
   ```
   npm install
   pip install -r python/requirements.txt
   ```
3. アプリケーションを起動：
   ```
   npm start
   ```

## 6. 使用方法

1. アプリケーションを起動
2. 入力ディレクトリ、出力ディレクトリ、ターゲットベースディレクトリを選択
3. 分離したい音源（ボーカル、ドラム、ベース、その他）を選択
4. 「実行」ボタンをクリックして処理を開始
5. 処理結果を確認

## 7. 主要コンポーネントの説明

### 7.1 audio_processing.py

音源分離の中核となる処理を行います。主な機能：
- MP3からWAVへの変換
- オーディオのリサンプリング
- OpenUnmixモデルを使用した音源分離

### 7.2 api.py

バックエンドのメイン処理を担当します。主な機能：
- ディレクトリの作成
- ファイルのリネームと移動
- 音源分離処理の実行と結果の返却

### 7.3 main.js

Electronアプリケーションのメインプロセスを制御します。主な機能：
- ウィンドウの作成と管理
- IPCを通じたレンダラープロセスとの通信
- Pythonスクリプトの実行

### 7.4 renderer.js

ユーザーインターフェースの動作を制御します。主な機能：
- ディレクトリ選択ダイアログの表示
- 処理の実行と結果の表示
- ダークモード切り替え

## 8. エラー処理

- 入力検証：必要なディレクトリが選択されているか、少なくとも1つの音源が選択されているかを確認
- 例外処理：Pythonスクリプトでの例外をキャッチし、詳細なエラーメッセージを表示

## 9. ビルドと配布

electron-builderを使用してアプリケーションをビルドします。

```
npm run build
```

macOS用のビルド：

```
npm run build:mac
```

## 10. 注意事項

- 大きなオーディオファイルの処理には時間がかかる場合があります
- 処理結果の品質は入力音源の品質に依存します
- システムのリソース使用量が高くなる可能性があるため、他の重要なタスクと同時に実行しないことをお勧めします

## 11. 今後の展開

- より多くの音源分離モデルのサポート
- バッチ処理機能の追加
- ユーザーインターフェースの改善
- クラウドストレージとの統合

このドキュメントは、システムの概要と使用方法を説明していますが、具体的な実装の詳細については、各ソースファイルを参照してください。